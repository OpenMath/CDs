
 
set -e




if [ "$TRAVIS" = "true" ] && [ "$TRAVIS_PULL_REQUEST" = "false" ]; then
   echo "travis job push to om website"
        cd ..
   	rm -rf OpenMath.github.io.git
	echo clone
	git config --global user.email "dpcarlisle@gmail.com"
	git config --global user.name "Travis CI"
	git config --global push.default simple

	git clone https://$ghauth@github.com/OpenMath/OpenMath.github.io.git
	if [ "$TRAVIS_EVENT_TYPE" = "push" ]; then
	case "$TRAVIS_COMMIT_MESSAGE" in
	*clean* )
	echo "clean build not copying files from OpenMath.github.io";;
	*)
	cp -p  OpenMath.github.io/cd/Official/*.html CDs/cd/Official
	cp -p  OpenMath.github.io/cd/Official/*.omcd CDs/cd/Official
	cp -p  OpenMath.github.io/cd/experimental/*.html CDs/cd/experimental
	cp -p  OpenMath.github.io/cd/experimental/*.omcd CDs/cd/experimental
	cp -p  OpenMath.github.io/sts/*.html CDs/sts
	cp -p  OpenMath.github.io/cdgroups/*.html CDs/cdgroups
	cp -p  OpenMath.github.io/contrib/cd/*.html CDs/contrib/cd
	cp -p  OpenMath.github.io/contrib/cd/*.omcd CDs/contrib/cd
	cp -p  OpenMath.github.io/contrib/sts/*.html CDs/contrib/sts
echo "checking cp -p"
ls -l CDs/contrib/cd
echo "contrib on website"
ls -l OpenMath.github.io/contrib/cd/*.html
	;;
	esac
	fi
        cd CDs
        make
	make cds.tar.gz
	make install
	cd ../OpenMath.github.io
	git commit -a -m "from travis ci: $TRAVIS_COMMIT_MESSAGE" || echo no changes
	git push
	
else
    echo skipping copying to website
fi


